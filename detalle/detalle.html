<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle del Perfume</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>

<!-- Header dinámico -->
<div id="header"></div>
<script>
  fetch('../header.html')
    .then(resp => resp.text())
    .then(html => {
      document.getElementById('header').innerHTML = html;
    });
</script>

<main id="detalle-perfume">
  <p id="loader">Cargando detalles del perfume...</p>
</main>

<!-- Botón fijo de WhatsApp -->
<div class="whatsapp-btn">
  <a id="btn-whatsapp" href="#" target="_blank">Consultar por WhatsApp</a>
</div>

<!-- Footer -->
<footer>
  © 2026 SC Parfums | Paraguay<br>
  Productos 100% originales | Medios de pago disponibles<br>
  Seguinos en 
  <a href="https://www.facebook.com/SCParfums">Facebook</a> |
  <a href="https://www.instagram.com/scparfumspy">Instagram</a> |
  <a href="https://www.tiktok.com/@scparfums">TikTok</a> |
  <a href="https://wa.me/595991861112">WhatsApp</a>
</footer>

<script>
  async function cargarDetalle() {
    const contenedor = document.getElementById('detalle-perfume');
    contenedor.innerHTML = '<p id="loader">Cargando detalles del perfume...</p>';

    try {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      const resp = await fetch('../data/detalles.json');
      const detalles = await resp.json();
      const perfume = detalles.find(p => p.id === id);

      const respCatalogo = await fetch('../data/perfumes.json');
      const catalogo = await respCatalogo.json();
      const datosBasicos = catalogo.find(p => p.id === id);

      const preciosResp = await fetch("https://script.google.com/macros/s/AKfycbwRNLbgXD_D7Qx72KpOvcsejuMSz_UXHlrgTm9vdSZ4_DXqoxP_Cx5y858xTXsKSOX2/exec");
      const precios = await preciosResp.json();
      const precioData = precios.find(pr => pr.id === id);
      let precio = "Consultar";
      if (precioData && precioData.precio != null) {
        precio = "₲ " + precioData.precio.toLocaleString("es-PY");
      }

      if (!perfume) {
        contenedor.innerHTML = '<p>Perfume no encontrado.</p>';
        return;
      }

      contenedor.innerHTML = `
        <div class="detalle-container">
          <div class="detalle-imagen">
            <img src="../${datosBasicos.imagen}" alt="${datosBasicos.nombre}">
          </div>
          <div class="detalle-info">
            <h1 class="detalle-titulo">${datosBasicos.nombre}</h1>
            <p class="detalle-marca"><strong>${datosBasicos.marca}</strong></p>
            <p class="precio">${precio}</p>

            <div class="detalle-card">
              <h3>Categoría</h3>
              <p>${datosBasicos.categoria}</p>
            </div>
            <div class="detalle-card">
              <h3>Acordes principales</h3>
              <ul>${perfume.acordes.map(a => `<li>${a}</li>`).join('')}</ul>
            </div>
            <div class="detalle-card">
              <h3>Notas de salida</h3>
              <ul>${perfume.notas_salida.map(n => `<li>${n}</li>`).join('')}</ul>
            </div>
            <div class="detalle-card">
              <h3>Notas de corazón</h3>
              <ul>${perfume.notas_corazon.map(n => `<li>${n}</li>`).join('')}</ul>
            </div>
            <div class="detalle-card">
              <h3>Notas de base</h3>
              <ul>${perfume.notas_base.map(n => `<li>${n}</li>`).join('')}</ul>
            </div>
            <div class="detalle-card">
              <h3>Ocasiones de uso</h3>
              <p>${perfume.ocasion || "No especificado"}</p>
            </div>
            <div class="detalle-card">
              <h3>Descripción</h3>
              <p>${perfume.descripcion}</p>
            </div>
          </div>
        </div>
      `;

      const btnWhats = document.getElementById("btn-whatsapp");
      btnWhats.href = `https://wa.me/595991861112?text=Hola, quiero consultar por el perfume ${perfume.nombre || perfume.id}`;
    } catch (error) {
      console.error("Error cargando detalle:", error);
      contenedor.innerHTML = '<p>Error al cargar detalles.</p>';
    }
  }

  cargarDetalle();
</script>
</body>
</html>

